---
import BaseLayout from '../layouts/BaseLayout.astro';

// Get all blog posts
const allPosts = await import.meta.glob('./posts/*.{md,mdx}', { eager: true });

// Filter out draft posts and sort by date
const publishedPosts = Object.values(allPosts)
  .filter(post => !post.frontmatter.draft)
  .sort((a, b) => new Date(b.frontmatter.pubDate).valueOf() - new Date(a.frontmatter.pubDate).valueOf());

// Get latest 5 posts for the homepage
const latestPosts = publishedPosts.slice(0, 5);

// Function to get excerpt from content
function getExcerpt(content: string | undefined, maxLength: number = 160): string {
  if (!content) return '';
  const textContent = content.replace(/<[^>]*>/g, '').replace(/\n/g, ' ');
  if (textContent.length <= maxLength) return textContent;
  return textContent.slice(0, maxLength).trim() + '...';
}
---

<BaseLayout title="Denys Korolkov">
  <div class="container">
    <section class="hero">
      <div class="hero-content">
        <h1>Hi, I'm Denys Korolkov</h1>
        <p class="hero-subtitle">
          Senior Frontend Engineer bringing visions to life with React, TypeScript, and modern web technologies.
        </p>
        <p class="hero-description">
          Highly motivated and result-driven developer with deep knowledge of full-stack development. 
          I've successfully built and delivered numerous web projects from small startups to large-scale enterprise applications.
        </p>
        <div class="hero-actions">
          <a href="/posts" class="btn btn-primary">Read My Blog</a>
          <a href="/about" class="btn btn-secondary">About Me</a>
        </div>
      </div>
    </section>

    <section class="latest-posts">
      <div class="section-header">
        <h2>Latest Posts</h2>
        <a href="/posts" class="view-all">View all posts →</a>
      </div>
      
      {latestPosts.length > 0 ? (
        <div class="post-list">
          {latestPosts.map((post) => {
            const excerpt = getExcerpt(post.frontmatter.description || '', 160);
            const formattedDate = new Date(post.frontmatter.pubDate).toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
            });
            
            return (
              <article class="post-card">
                <div class="post-card-meta">
                  <time datetime={post.frontmatter.pubDate}>{formattedDate}</time>
                  {post.frontmatter.tags && post.frontmatter.tags.length > 0 && (
                    <span>• {post.frontmatter.tags.length} tag{post.frontmatter.tags.length !== 1 ? 's' : ''}</span>
                  )}
                </div>
                <h2>
                  <a href={post.url}>{post.frontmatter.title}</a>
                </h2>
                <p class="post-card-excerpt">{excerpt}</p>
                {post.frontmatter.tags && post.frontmatter.tags.length > 0 && (
                  <div class="post-card-tags">
                    {post.frontmatter.tags.slice(0, 3).map((tag) => (
                      <span class="post-card-tag">#{tag}</span>
                    ))}
                    {post.frontmatter.tags.length > 3 && (
                      <span class="post-card-tag">+{post.frontmatter.tags.length - 3}</span>
                    )}
                  </div>
                )}
              </article>
            );
          })}
        </div>
      ) : (
        <div class="no-posts">
          <p>No blog posts yet. Check back soon!</p>
          <p><em>To add posts, create markdown files in <code>src/pages/posts/</code></em></p>
        </div>
      )}
    </section>
  </div>
</BaseLayout>

<style>
  .hero {
    text-align: center;
    padding: 4rem 0 6rem;
    max-width: 800px;
    margin: 0 auto;
  }

  .hero h1 {
    font-size: 3.5rem;
    font-weight: 800;
    margin-bottom: 1.5rem;
    background: linear-gradient(135deg, var(--accent-color), #8b5cf6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .hero-subtitle {
    font-size: 1.5rem;
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
    line-height: 1.4;
  }

  .hero-description {
    font-size: 1.125rem;
    color: var(--text-secondary);
    margin-bottom: 2.5rem;
    line-height: 1.6;
  }

  .hero-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    padding: 0.875rem 1.5rem;
    border-radius: 0.5rem;
    text-decoration: none;
    font-weight: 600;
    transition: var(--transition);
    border: 2px solid transparent;
  }

  .btn-primary {
    background: var(--accent-color);
    color: white;
  }

  .btn-primary:hover {
    background: var(--accent-hover);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
  }

  .btn-secondary {
    border-color: var(--border-color);
    color: var(--text-primary);
  }

  .btn-secondary:hover {
    border-color: var(--accent-color);
    color: var(--accent-color);
    transform: translateY(-2px);
  }

  .latest-posts {
    margin-top: 4rem;
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
  }

  .section-header h2 {
    font-size: 2rem;
    font-weight: 700;
  }

  .view-all {
    color: var(--accent-color);
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
  }

  .view-all:hover {
    text-decoration: underline;
  }

  .no-posts {
    text-align: center;
    padding: 3rem;
    background: var(--background-secondary);
    border-radius: 0.75rem;
    border: 1px solid var(--border-color);
  }

  .no-posts p {
    color: var(--text-secondary);
    margin-bottom: 1rem;
  }

  .no-posts p:last-child {
    margin-bottom: 0;
  }

  .no-posts code {
    background: var(--code-bg);
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }

  @media (max-width: 768px) {
    .hero {
      padding: 2rem 0 4rem;
    }

    .hero h1 {
      font-size: 2.5rem;
    }

    .hero-subtitle {
      font-size: 1.25rem;
    }

    .hero-actions {
      flex-direction: column;
      align-items: center;
    }

    .btn {
      width: 100%;
      max-width: 200px;
      justify-content: center;
    }

    .section-header {
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }
  }
</style>